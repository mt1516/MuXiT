(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5525:function(e,t,s){Promise.resolve().then(s.bind(s,3748))},3748:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return page}});var a=s(7437),i=s(2265);s(1559);var components_history=e=>{let{history:t,activeChat:s,onSelectChat:i,onNewChat:n,onDeleteChat:r}=e,handleDelete=(e,t)=>{e.stopPropagation(),r(t)};return(0,a.jsxs)("div",{className:"chat-history",children:[(0,a.jsx)("button",{className:"new-chat-setting-button",onClick:n,children:"Add New Chat"}),(0,a.jsx)("button",{className:"new-chat-setting-button",children:"Setting"}),(0,a.jsx)("div",{className:"history-list",children:t.map(e=>(0,a.jsxs)("div",{className:"history-item ".concat(s===e.id?"active":""),onClick:()=>i(e.id),children:[(0,a.jsx)("div",{className:"history-item-title",children:e.title}),(0,a.jsx)("button",{className:"delete-button",onClick:t=>handleDelete(t,e.id),children:"\uD83D\uDDD1️"})]},e.id))})]})},components_message=e=>{let{message:t}=e,s=t.audioFile?URL.createObjectURL(t.audioFile):null;return(0,a.jsx)("div",{className:"message ".concat(t.sender),children:(0,a.jsxs)("div",{className:"message-content",children:["user"===t.sender&&t.audioFile&&(0,a.jsxs)("div",{children:[t.text&&(0,a.jsx)("div",{className:"message-text",children:t.text}),(0,a.jsxs)("div",{children:[(0,a.jsx)("audio",{controls:!0,src:s||void 0,children:"Your browser does not support audio."}),(0,a.jsx)("span",{className:"audio-label",children:"Your audio"})]})]}),"user"===t.sender&&!t.audioFile&&(0,a.jsx)("div",{className:"message-text",children:t.text}),"ai"===t.sender&&t.audioUrl&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"message-text",children:t.text}),(0,a.jsxs)("div",{children:[(0,a.jsx)("audio",{controls:!0,src:t.audioUrl,children:"Your browser does not support audio."}),(0,a.jsx)("span",{className:"audio-label",children:"Generated music"})]})]}),"ai"===t.sender&&!t.audioUrl&&(0,a.jsx)("div",{className:"message-text",children:t.text}),t.error&&(0,a.jsx)("div",{className:"error-message",children:"⚠️ Error generating music"})]})})},chatbot=e=>{let{messages:t}=e;return(0,a.jsx)("div",{className:"chat-main",children:(0,a.jsx)("div",{className:"messages-container",children:t.map(e=>(0,a.jsx)(components_message,{message:e},e.id))})})},input=e=>{let{onSendMessage:t,pendingAudio:s,setPendingAudio:n}=e,[r,o]=(0,i.useState)(""),l=(0,i.useRef)(null);return(0,a.jsxs)("form",{className:"chat-input",onSubmit:e=>{e.preventDefault(),(r.trim()||s)&&(t(r,s||void 0),o(""))},children:[(0,a.jsx)("input",{type:"text",value:r,onChange:e=>o(e.target.value),placeholder:"Describe your music..."}),(0,a.jsx)("input",{type:"file",ref:l,onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&n(s)},accept:"audio/*",style:{display:"none"}}),(0,a.jsxs)("div",{className:"audio-controls",children:[(0,a.jsx)("button",{type:"button",className:"audio-button ".concat(s?"active":""),onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},children:s?"Uploaded":"Add Audio"}),s&&(0,a.jsxs)("div",{className:"audio-preview",children:[(0,a.jsx)("span",{children:s.name}),(0,a.jsx)("button",{type:"button",className:"remove-audio",onClick:()=>{n(null),l.current&&(l.current.value="")},children:"\xd7"})]})]}),(0,a.jsx)("button",{type:"submit",className:"send-button",disabled:!r&&!s,children:"Send"})]})},n=s(4829),page=()=>{let[e,t]=(0,i.useState)([]),[s,r]=(0,i.useState)(()=>[{id:"1",title:"New Chat",messages:[{id:"1",text:"Hello! Describe your music or upload audio to generate!",sender:"ai"}]}]),[o,l]=(0,i.useState)("1"),[d,c]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=s.find(e=>e.id===o);e?t(e.messages):t([])},[o,s]);let updateHistory=e=>{r(t=>t.map(t=>t.id===o?{...t,messages:[...t.messages,e],title:1===t.messages.length&&"user"===e.sender?e.text.slice(0,30)+(e.text.length>30?"...":""):t.title}:t))},handleSendMessage=async(e,s)=>{let a={id:Date.now().toString(),text:e||(s?"Audio input":""),sender:"user",isAudio:!!s,audioFile:s};t(e=>[...e,a]),updateHistory(a),c(null);try{let a=new FormData;a.append("prompt",e||"Generate music"),a.append("duration",String(30)),s&&a.append("audio_input",s);let i=await fetch("http://localhost:8000/generate-music/",{method:"POST",body:a});if(!i.ok){let e=await i.json();throw console.error("Error details:",e),Error(e.detail||"Failed to generate music")}let r=await i.blob(),o=URL.createObjectURL(r),l=await n.Z.post("http://localhost:8001/generate",{text:e}),d={id:Date.now().toString(),text:e?l.data.text:"Generated music",sender:"ai",audioUrl:o};t(e=>[...e,d]),updateHistory(d)}catch(s){console.error("Error:",s);let e={id:Date.now().toString(),text:"Error generating music",sender:"ai",error:!0};t(t=>[...t,e]),updateHistory(e)}};return(0,a.jsxs)("div",{className:"app",children:[(0,a.jsx)(components_history,{history:s,activeChat:o,onSelectChat:l,onNewChat:()=>{let e=Date.now().toString(),t={id:e,title:"New Chat",messages:[{id:"1",text:"Hello! Describe your music or upload audio to generate!",sender:"ai"}]};r(e=>[t,...e]),l(e),c(null)},onDeleteChat:e=>{r(t=>t.filter(t=>t.id!==e)),e===o&&l(t=>{let a=s.filter(t=>t.id!==e);return a.length>0?a[0].id:""})}}),(0,a.jsxs)("div",{className:"chat-container",children:[(0,a.jsx)(chatbot,{messages:e}),(0,a.jsx)(input,{onSendMessage:handleSendMessage,pendingAudio:d,setPendingAudio:c})]})]})}},1559:function(){}},function(e){e.O(0,[737,971,472,744],function(){return e(e.s=5525)}),_N_E=e.O()}]);