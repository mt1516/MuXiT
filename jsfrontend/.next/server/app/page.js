(()=>{var e={};e.id=931,e.ids=[931],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")},6880:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var a=s(7096),r=s(6132),i=s(7284),n=s.n(i),o=s(2564),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8203)),"C:\\Users\\cchin\\Documents\\UST\\FYP\\MuXiT\\jsfrontend\\src\\app\\page.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,9113)),"C:\\Users\\cchin\\Documents\\UST\\FYP\\MuXiT\\jsfrontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["C:\\Users\\cchin\\Documents\\UST\\FYP\\MuXiT\\jsfrontend\\src\\app\\page.tsx"],u="/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2825:(e,t,s)=>{Promise.resolve().then(s.bind(s,6569))},6569:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>page});var a=s(784),r=s(9885);s(8604);let components_history=({history:e,activeChat:t,onSelectChat:s,onNewChat:r,onDeleteChat:i})=>{let handleDelete=(e,t)=>{e.stopPropagation(),i(t)};return(0,a.jsxs)("div",{className:"chat-history",children:[a.jsx("button",{className:"new-chat-setting-button",onClick:r,children:"Add New Chat"}),a.jsx("div",{className:"history-list",children:e.map(e=>(0,a.jsxs)("div",{className:`history-item ${t===e.id?"active":""}`,onClick:()=>s(e.id),children:[a.jsx("div",{className:"history-item-title",children:e.title}),a.jsx("button",{className:"delete-button",onClick:t=>handleDelete(t,e.id),children:"\uD83D\uDDD1️"})]},e.id))})]})},components_message=({message:e})=>{let t=e.audioFile?URL.createObjectURL(e.audioFile):null;return a.jsx("div",{className:`message ${e.sender}`,children:(0,a.jsxs)("div",{className:"message-content",children:["user"===e.sender&&e.audioFile&&(0,a.jsxs)("div",{children:[e.text&&a.jsx("div",{className:"message-text",children:e.text}),(0,a.jsxs)("div",{children:[a.jsx("audio",{controls:!0,src:t||void 0,children:"Your browser does not support audio."}),a.jsx("span",{className:"audio-label",children:"Your audio"})]})]}),"user"===e.sender&&!e.audioFile&&a.jsx("div",{className:"message-text",children:e.text}),"ai"===e.sender&&e.audioUrl&&(0,a.jsxs)("div",{children:[a.jsx("div",{className:"message-text",children:e.text}),(0,a.jsxs)("div",{children:[a.jsx("audio",{controls:!0,src:e.audioUrl,children:"Your browser does not support audio."}),a.jsx("span",{className:"audio-label",children:"Generated music"})]})]}),"ai"===e.sender&&!e.audioUrl&&a.jsx("div",{className:"message-text",children:e.text}),e.error&&a.jsx("div",{className:"error-message",children:"⚠️ Error generating music"})]})})},chatbot=({messages:e})=>a.jsx("div",{className:"chat-main",children:a.jsx("div",{className:"messages-container",children:e.map(e=>a.jsx(components_message,{message:e},e.id))})}),input=({onSendMessage:e,pendingAudio:t,setPendingAudio:s})=>{let[i,n]=(0,r.useState)(""),[o,l]=(0,r.useState)(30),d=(0,r.useRef)(null);return(0,a.jsxs)("form",{className:"chat-input",onSubmit:s=>{s.preventDefault(),(i.trim()||t)&&(e(i,o,t||void 0),n(""))},children:[a.jsx("input",{className:"chat-input-text",type:"text",value:i,onChange:e=>n(e.target.value),placeholder:"Describe your music..."}),(0,a.jsxs)("div",{className:"duration",children:[a.jsx("span",{className:"duration-label",children:"Duration (seconds)"}),a.jsx("input",{className:"chat-input-duration",type:"number",min:"1",max:"300",value:o,onChange:e=>l(Math.min(300,Math.max(1,Number(e.target.value))))})]}),a.jsx("input",{type:"file",ref:d,onChange:e=>{let t=e.target.files?.[0];t&&s(t)},accept:"audio/*",style:{display:"none"}}),(0,a.jsxs)("div",{className:"audio-controls",children:[a.jsx("button",{type:"button",className:`audio-button ${t?"active":""}`,onClick:()=>d.current?.click(),children:t?"Uploaded":"Add Audio"}),t&&(0,a.jsxs)("div",{className:"audio-preview",children:[a.jsx("span",{children:t.name}),a.jsx("button",{type:"button",className:"remove-audio",onClick:()=>{s(null),d.current&&(d.current.value="")},children:"\xd7"})]})]}),a.jsx("button",{type:"submit",className:"send-button",disabled:!i&&!t,children:"Send"})]})},getLocalStorage=e=>null,setLocalStorage=(e,t)=>{},page=()=>{let[e,t]=(0,r.useState)(!1),[s,i]=(0,r.useState)([]),[n,o]=function(e,t){let[s,a]=(0,r.useState)(()=>t);return[s,e=>{try{let t=e instanceof Function?e(s):e;a(t)}catch(e){console.error(e)}}]}(0,[{id:"1",title:"New Chat",messages:[{id:"1",text:"Hello! Describe your music or upload audio to generate!",sender:"ai"}],createdAt:Date.now()}]);(0,r.useEffect)(()=>{t(!0);let e=getLocalStorage("musicChatHistory"),s=e?JSON.parse(e):[{id:"1",title:"New Chat",messages:[{id:"1",text:"Hello! Describe your music or upload audio to generate!",sender:"ai"}],createdAt:Date.now()}];o(s),d(s[0].id)},[]);let[l,d]=(0,r.useState)("1"),[c,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=n.find(e=>e.id===l);i(e?.messages||[])},[l,n]),(0,r.useEffect)(()=>{let e=n.map(e=>({...e,messages:e.messages.map(e=>({...e,audioUrl:void 0}))}));setLocalStorage("musicChatHistory",JSON.stringify(e))},[n,e]),(0,r.useEffect)(()=>{let e=s.map(e=>{if(e.audioData&&!e.audioUrl)try{let t=atob(e.audioData.split(",")[1]),s=new ArrayBuffer(t.length),a=new Uint8Array(s);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);let r=new Blob([s],{type:"audio/wav"});return{...e,audioUrl:URL.createObjectURL(r)}}catch(e){console.error("Error recreating audio:",e)}return e});return JSON.stringify(e)!==JSON.stringify(s)&&i(e),()=>{e.forEach(e=>{e.audioUrl&&URL.revokeObjectURL(e.audioUrl)})}},[s]);let updateHistory=e=>{o(t=>{let s=t.map(t=>t.id===l?{...t,messages:[...t.messages,e],title:1===t.messages.length&&"user"===e.sender?e.text.slice(0,30)+(e.text.length>30?"...":""):t.title}:t),a=s.find(e=>e.id===l);return i(a?.messages||[]),s})},handleSendMessage=async(e,t,s)=>{let a={id:Date.now().toString(),text:e||(s?"Audio input":""),sender:"user",isAudio:!!s,audioFile:s};updateHistory(a),u(null);try{let a=new FormData;a.append("prompt",e||"Generate music"),a.append("duration",String(t)),s&&a.append("audio_input",s);let r=await fetch("http://localhost:8000/generate-music/",{method:"POST",body:a});if(!r.ok){let e=await r.json();throw console.error("Error details:",e),Error(e.detail||"Failed to generate music")}let i=await r.blob();URL.createObjectURL(i),await new Promise(e=>{let t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(i)})}catch(t){console.error("Error:",t);let e={id:Date.now().toString(),text:"Error generating music",sender:"ai",error:!0};updateHistory(e)}};return a.jsx("div",{className:"app",children:e?(0,a.jsxs)(a.Fragment,{children:[a.jsx(components_history,{history:n,activeChat:l,onSelectChat:d,onNewChat:()=>{let e=Date.now().toString(),t={id:e,title:"New Chat",messages:[{id:"1",text:"Hello! Describe your music or upload audio to generate!",sender:"ai"}],createdAt:Date.now()};o(e=>[t,...e]),d(e),u(null)},onDeleteChat:e=>{o(t=>t.filter(t=>t.id!==e)),e===l&&d(e=>n.find(t=>t.id!==e)?.id||"")}}),(0,a.jsxs)("div",{className:"chat-container",children:[a.jsx(chatbot,{messages:s}),a.jsx(input,{onSendMessage:handleSendMessage,pendingAudio:c,setPendingAudio:u})]})]}):a.jsx("div",{children:"Loading..."})})}},8203:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>l});var a=s(5153);let r=(0,a.createProxy)(String.raw`C:\Users\cchin\Documents\UST\FYP\MuXiT\jsfrontend\src\app\page.tsx`),{__esModule:i,$$typeof:n}=r,o=r.default,l=o},3881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var a=s(8531);let __WEBPACK_DEFAULT_EXPORT__=e=>{let t=(0,a.fillMetadataSegment)(".",e.params,"favicon.ico");return[{type:"image/x-icon",sizes:"32x14",url:t+""}]}},8604:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[164,52,493],()=>__webpack_exec__(6880));module.exports=s})();